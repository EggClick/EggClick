<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–ö–ª–∏–∫–µ—Ä –Ø–π—Ü–æ</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: #fff9e6; /* —á—É—Ç—å –∂–µ–ª—Ç—ã–π —Ñ–æ–Ω */
    color: #333;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    user-select: none;
  }
  #loginBtn {
    font-size: 18px;
    padding: 10px 20px;
    cursor: pointer;
    margin-top: 100px;
    border: none;
    border-radius: 6px;
    background-color: #4285F4;
    color: white;
  }
  #mainContent {
    display: none;
    width: 360px;
    max-width: 100%;
  }
  #egg {
    font-size: 120px;
    cursor: pointer;
    text-align: center;
    user-select: none;
    margin-bottom: 10px;
  }
  #clicks {
    font-size: 24px;
    margin-bottom: 15px;
    text-align: center;
  }
  #shop, #skins {
    margin-bottom: 20px;
  }
  .shop-item, .skin-item {
    background: white;
    border-radius: 8px;
    padding: 10px;
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  .shop-item button, .skin-item button {
    cursor: pointer;
    padding: 6px 12px;
    border: none;
    border-radius: 4px;
    background-color: #4285F4;
    color: white;
  }
  .skin-item button:disabled {
    background-color: #aaa;
    cursor: default;
  }
  #leaderboard {
    background: white;
    border-radius: 8px;
    padding: 10px;
    max-height: 180px;
    overflow-y: auto;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  #leaderboard h3 {
    margin-top: 0;
    margin-bottom: 10px;
    text-align: center;
  }
  #leaderboard ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  #leaderboard li {
    padding: 4px 0;
    border-bottom: 1px solid #eee;
  }
</style>
</head>
<body>

<button id="loginBtn">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>

<div id="mainContent">
  <div id="egg">ü•ö</div>
  <div id="clicks">–ö–ª–∏–∫–∏: 0</div>

  <div id="shop">
    <h3>–ú–∞–≥–∞–∑–∏–Ω</h3>
    <div class="shop-item">
      <div>–§–µ—Ä–º–∞ (200 ü•ö) ‚Äî –º–∞–∫—Å–∏–º—É–º 5</div>
      <button id="buyFarmBtn">–ö—É–ø–∏—Ç—å</button>
    </div>
    <div class="shop-item">
      <div>–ü—Ä–æ–∫–∞—á–∫–∞ (+–∫–ª–∏–∫–∏) (700 ü•ö) ‚Äî –º–∞–∫—Å–∏–º—É–º 10</div>
      <button id="buyUpgradeBtn">–ö—É–ø–∏—Ç—å</button>
    </div>
    <div class="shop-item">
      <div>–ù–æ–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ (1500 ü•ö)</div>
      <button id="buyNewItemBtn">–ö—É–ø–∏—Ç—å</button>
    </div>
  </div>

  <div id="skins">
    <h3>–°–∫–∏–Ω—ã (–ø–ª–∞—Ç–Ω—ã–µ)</h3>
    <div class="skin-item">
      <div>–¶—ã–ø–ª–µ–Ω–æ–∫ üê• ‚Äî 5000 ü•ö</div>
      <button id="buyChickenSkinBtn">–ö—É–ø–∏—Ç—å</button>
    </div>
    <div class="skin-item">
      <div>–£—Ç—ë–Ω–æ–∫ ü¶Ü ‚Äî 8000 ü•ö</div>
      <button id="buyDuckSkinBtn">–ö—É–ø–∏—Ç—å</button>
    </div>
  </div>

  <div id="leaderboard">
    <h3>–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h3>
    <ul id="leaderboardList"></ul>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  // –ö–æ–Ω—Ñ–∏–≥ Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyDjLs-TCbJbpqdXhKwuu2t1cjTjWQHYB-g",
    authDomain: "eggclick-e90e2.firebaseapp.com",
    projectId: "eggclick-e90e2",
    storageBucket: "eggclick-e90e2.appspot.com",
    messagingSenderId: "24681943629",
    appId: "1:24681943629:web:7a321f0bab80eb7b070204",
    measurementId: "G-C9QNNDDKWJ"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const auth = getAuth();

  const loginBtn = document.getElementById("loginBtn");
  const mainContent = document.getElementById("mainContent");
  const egg = document.getElementById("egg");
  const clicksDisplay = document.getElementById("clicks");

  const buyFarmBtn = document.getElementById("buyFarmBtn");
  const buyUpgradeBtn = document.getElementById("buyUpgradeBtn");
  const buyNewItemBtn = document.getElementById("buyNewItemBtn");

  const buyChickenSkinBtn = document.getElementById("buyChickenSkinBtn");
  const buyDuckSkinBtn = document.getElementById("buyDuckSkinBtn");

  const leaderboardList = document.getElementById("leaderboardList");

  let user = null;

  let clicks = 0;
  let farms = 0;
  let upgrades = 0;
  let newItemBought = false;

  let skin = "ü•ö";

  // –¶–µ–Ω—ã –∏ –ª–∏–º–∏—Ç—ã
  const FARM_PRICE = 200;
  const FARM_MAX = 5;

  const UPGRADE_PRICE = 700;
  const UPGRADE_MAX = 10;

  const NEW_ITEM_PRICE = 1500;

  const SKINS = {
    "üê•": 5000,
    "ü¶Ü": 8000
  };

  let ownedSkins = new Set();

  function save() {
    if (!user) return;

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firestore
    const userRef = doc(db, "users", user.uid);
    updateDoc(userRef, {
      clicks,
      farms,
      upgrades,
      newItemBought,
      skin,
      ownedSkins: Array.from(ownedSkins),
      lastSave: Date.now()
    }).catch(console.error);

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –≤—Å—è–∫–∏–π
    localStorage.setItem("clicks", clicks);
    localStorage.setItem("farms", farms);
    localStorage.setItem("upgrades", upgrades);
    localStorage.setItem("newItemBought", newItemBought ? "1" : "0");
    localStorage.setItem("skin", skin);
    localStorage.setItem("ownedSkins", JSON.stringify(Array.from(ownedSkins)));
  }

  async function load() {
    if (!user) return;

    const userRef = doc(db, "users", user.uid);
    const docSnap = await getDoc(userRef);
    if (docSnap.exists()) {
      const data = docSnap.data();
      clicks = data.clicks || 0;
      farms = data.farms || 0;
      upgrades = data.upgrades || 0;
      newItemBought = data.newItemBought || false;
      skin = data.skin || "ü•ö";
      ownedSkins = new Set(data.ownedSkins || []);
    } else {
      // –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî —Å–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å
      await setDoc(userRef, {
        name: user.displayName,
        clicks: 0,
        farms: 0,
        upgrades: 0,
        newItemBought: false,
        skin: "ü•ö",
        ownedSkins: []
      });
      clicks = 0; farms = 0; upgrades = 0; newItemBought = false; skin = "ü•ö"; ownedSkins = new Set();
    }

    // –î–ª—è –ø–æ–¥—Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ ‚Äî –ø–æ–¥–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª —Å—Ç–æ—Ä–µ–¥–∂
    clicks = +localStorage.getItem("clicks") || clicks;
    farms = +localStorage.getItem("farms") || farms;
    upgrades = +localStorage.getItem("upgrades") || upgrades;
    newItemBought = localStorage.getItem("newItemBought") === "1" || newItemBought;
    skin = localStorage.getItem("skin") || skin;
    try {
      const lsSkins = JSON.parse(localStorage.getItem("ownedSkins"));
      if (Array.isArray(lsSkins)) ownedSkins = new Set(lsSkins);
    } catch {}

    updateUI();
  }

  function updateUI() {
    clicksDisplay.textContent = `–ö–ª–∏–∫–∏: ${clicks}`;
    egg.textContent = skin;

    buyFarmBtn.disabled = farms >= FARM_MAX || clicks < FARM_PRICE;
    buyUpgradeBtn.disabled = upgrades >= UPGRADE_MAX || clicks < UPGRADE_PRICE;
    buyNewItemBtn.disabled = newItemBought || clicks < NEW_ITEM_PRICE;

    buyChickenSkinBtn.disabled = ownedSkins.has("üê•") || clicks < SKINS["üê•"];
    buyDuckSkinBtn.disabled = ownedSkins.has("ü¶Ü") || clicks < SKINS["ü¶Ü"];
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –ª–∏–¥–µ—Ä–æ–≤ –∏–∑ Firebase
  async function loadLeaderboard() {
    leaderboardList.innerHTML = "";
    const q = query(collection(db, "users"), orderBy("clicks", "desc"), limit(10));
    const querySnapshot = await getDocs(q);
    querySnapshot.forEach((docSnap) => {
      const data = docSnap.data();
      const name = data.name || "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ";
      const score = data.clicks || 0;
      const li = document.createElement("li");
      li.textContent = `${name}: ${score} –∫–ª–∏–∫–æ–≤`;
      leaderboardList.appendChild(li);
    });
  }

  // –ö–ª–∏–∫–∏ –ø–æ —è–π—Ü—É
  egg.addEventListener("click", () => {
    clicks += 1 + upgrades;
    updateUI();
  });

  // –ü–æ–∫—É–ø–∫–∞ —Ñ–µ—Ä–º—ã
  buyFarmBtn.onclick = () => {
    if (clicks >= FARM_PRICE && farms < FARM_MAX) {
      clicks -= FARM_PRICE;
      farms++;
      updateUI();
      save();
    }
  };

  // –ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–∫–∞—á–∫–∏
  buyUpgradeBtn.onclick = () => {
    if (clicks >= UPGRADE_PRICE && upgrades < UPGRADE_MAX) {
      clicks -= UPGRADE_PRICE;
      upgrades++;
      updateUI();
      save();
    }
  };

  // –ü–æ–∫—É–ø–∫–∞ –Ω–æ–≤–æ–≥–æ —É–ª—É—á—à–µ–Ω–∏—è (–º–æ–∂–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É)
  buyNewItemBtn.onclick = () => {
    if (clicks >= NEW_ITEM_PRICE && !newItemBought) {
      clicks -= NEW_ITEM_PRICE;
      newItemBought = true;
      alert("–í—ã –∫—É–ø–∏–ª–∏ –Ω–æ–≤–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ! (–ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –¥–µ–π—Å—Ç–≤–∏–µ)");
      updateUI();
      save();
    }
  };

  // –ü–æ–∫—É–ø–∫–∞ —Å–∫–∏–Ω–æ–≤
  buyChickenSkinBtn.onclick = () => {
    if (clicks >= SKINS["üê•"] && !ownedSkins.has("üê•")) {
      clicks -= SKINS["üê•"];
      skin = "üê•";
      ownedSkins.add("üê•");
      updateUI();
      save();
    }
  };

  buyDuckSkinBtn.onclick = () => {
    if (clicks >= SKINS["ü¶Ü"] && !ownedSkins.has("ü¶Ü")) {
      clicks -= SKINS["ü¶Ü"];
      skin = "ü¶Ü";
      ownedSkins.add("ü¶Ü");
      updateUI();
      save();
    }
  };

  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª–∏–∫–∏ –æ—Ç —Ñ–µ—Ä–º (–∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã)
  setInterval(() => {
    if (farms > 0) {
      // –§–µ—Ä–º—ã –¥–∞—é—Ç –æ—Ç 1 –¥–æ 2 –∫–ª–∏–∫–æ–≤ –∑–∞ 2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –∫–∞–∂–¥—É—é —Ñ–µ—Ä–º—É
      for (let i = 0; i < farms; i++) {
        clicks += Math.floor(Math.random() * 2) + 1 + upgrades;
      }
      updateUI();
      save();
    }
  }, 2000);

  // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –∫–Ω–æ–ø–∫–µ
  loginBtn.onclick = async () => {
    const provider = new GoogleAuthProvider();
    try {
      const result = await signInWithPopup(auth, provider);
      user = result.user;
      loginBtn.style.display = "none";
      mainContent.style.display = "block";
      await load();
      await loadLeaderboard();
    } catch (error) {
      alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Google: " + error.message);
    }
  };

  // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  onAuthStateChanged(auth, async (usr) => {
    if (usr) {
      user = usr;
      loginBtn.style.display = "none";
      mainContent.style.display = "block";
      await load();
      await loadLeaderboard();
    } else {
      user = null;
      loginBtn.style.display = "block";
      mainContent.style.display = "none";
    }
  });

  // –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
  setInterval(save, 10000);
</script>
</body>
</html>
